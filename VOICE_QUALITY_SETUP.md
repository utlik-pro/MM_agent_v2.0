# Voice Quality Setup для MinskMir Agent

## Обзор

Этот документ описывает настройки для достижения высокого качества голоса и предотвращения проблем с Google Real-time API.

## ✅ Решенные проблемы с автозапуском функций

### Проблема: Агент автоматически запускал функции
- **Симптомы**: Функции срабатывали при словах "квартира", "семья", "район"
- **Причина**: Google Real-time API автоматически определял намерения
- **Решение**: Добавлен фильтр в функции + улучшенные промпты

### Исправления в agent.py:
```python
# Фильтр общих фраз
general_phrases = ["привет", "здравствуйте", "добро пожаловать", "как дела", "семья", "помочь"]
if any(phrase in client_request.lower() for phrase in general_phrases):
    return "Общий запрос - обработка не требуется"

# Таймаут для RAG запросов  
result = await asyncio.wait_for(
    llm.process_query(client_request),
    timeout=10.0  # Максимум 10 секунд
)
```

### Улучшенные промпты:
- Явные правила использования функций
- Запрет автозапуска при приветствии
- Естественный диалог ПЕРЕД функциями

## Настройки качества голоса

### Google Real-time API Configuration

```python
google_llm = google.LLM(
    model="models/gemini-2.0-flash-exp",
    api_key=os.getenv("GOOGLE_API_KEY"),
    voice_id="aoede",  # Женский голос
    language="ru",     # Русский язык
)
```

### Рекомендации по качеству:
1. **Используйте стабильное интернет соединение**
2. **Настройте качественный микрофон** 
3. **Избегайте фонового шума**
4. **Говорите четко и не слишком быстро**

## Устранение неполадок

### Если агент не отвечает:
1. Проверьте `GOOGLE_API_KEY` в .env
2. Убедитесь что RAG система инициализирована
3. Проверьте логи на ошибки

### Если качество голоса плохое:
1. Проверьте настройки микрофона
2. Убедитесь в стабильности сети
3. Попробуйте другой браузер

### Если функции запускаются автоматически:
1. ✅ **ИСПРАВЛЕНО**: Обновлены промпты и фильтры
2. Агент теперь ждет явных запросов
3. Приветствие не запускает функции

## Мониторинг производительности

- RAG запросы: максимум 10 секунд
- Голосовые ответы: 2-3 секунды  
- Общее время ответа: до 15 секунд

## Тестирование

Протестируйте следующие сценарии:
1. **Приветствие**: "Привет" → Не должно запускать функции
2. **Общие фразы**: "Семья", "Помощь" → Обычный диалог
3. **Явные запросы**: "Квартира до 50000 евро" → Запуск RAG функции