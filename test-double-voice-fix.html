<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–≤–æ–π–Ω–æ–≥–æ –≥–æ–ª–æ—Å–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }
        .fix-status {
            background: #e8f5e8;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #4caf50;
        }
        .issue {
            background: #ffebee;
            border-color: #f44336;
        }
        .log {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        .test-steps {
            background: #fff3e0;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #ff9800;
        }
        .button-group {
            margin: 20px 0;
            text-align: center;
        }
        .test-button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: white;
        }
        .test-button.primary { background: #2196f3; }
        .test-button.success { background: #4caf50; }
        .test-button.warning { background: #ff9800; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéôÔ∏è –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–≤–æ–π–Ω–æ–≥–æ –≥–æ–ª–æ—Å–∞</h1>
        
        <div class="test-info">
            <h3>üîß –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:</h3>
            <ul>
                <li><strong>–£–¥–∞–ª–µ–Ω–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–∞</strong> - –±–æ–ª—å—à–µ –Ω–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≥–µ–Ω—Ç–æ–≤</li>
                <li><strong>–£–ª—É—á—à–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤</strong> - –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ DOM</li>
                <li><strong>–î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–µ–∫–æ–≤</strong> - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö audio —ç–ª–µ–º–µ–Ω—Ç–æ–≤</li>
                <li><strong>–£—Å–∏–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π</strong> - –æ—á–∏—Å—Ç–∫–∞ –ø–µ—Ä–µ–¥ –Ω–æ–≤—ã–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º</li>
            </ul>
        </div>

        <div id="fix-status" class="fix-status">
            ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∏ –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã –Ω–∞ Vercel
        </div>

        <div class="test-steps">
            <h3>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:</h3>
            <ol>
                <li><strong>–ü–µ—Ä–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</strong>: –ù–∞–∂–º–∏—Ç–µ "–ü–æ–∑–≤–æ–Ω–∏—Ç—å" –∏ –ø—Ä–∏—Å–ª—É—à–∞–π—Ç–µ—Å—å –∫ –≥–æ–ª–æ—Å—É –∞–≥–µ–Ω—Ç–∞</li>
                <li><strong>–î–æ–ª–∂–µ–Ω –±—ã—Ç—å –û–î–ò–ù –≥–æ–ª–æ—Å</strong>: –ß–µ—Ç–∫–∏–π, –±–µ–∑ —ç—Ö–∞ –∏–ª–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è</li>
                <li><strong>–ó–∞–≤–µ—Ä—à–∏—Ç–µ</strong>: –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≤–µ—Ä—à–∏—Ç—å" –∏ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∞—É–¥–∏–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–µ–∫—Ä–∞—Ç–∏–ª–æ—Å—å</li>
                <li><strong>–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</strong>: –°–Ω–æ–≤–∞ –Ω–∞–∂–º–∏—Ç–µ "–ü–æ–∑–≤–æ–Ω–∏—Ç—å"</li>
                <li><strong>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏</strong>: –ü–æ—Å–ª–µ 2-3 –ø–æ–ø—ã—Ç–æ–∫ –≥–æ–ª–æ—Å –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º</li>
            </ol>
            <p><strong>‚ùå –†–∞–Ω—å—à–µ</strong>: –°–ª—ã—à–∞–ª–æ—Å—å –¥–≤–∞ –≥–æ–ª–æ—Å–∞, –æ–¥–∏–Ω –∑–∞ –¥—Ä—É–≥–∏–º</p>
            <p><strong>‚úÖ –¢–µ–ø–µ—Ä—å</strong>: –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —á–µ—Ç–∫–∏–π –≥–æ–ª–æ—Å –∞–≥–µ–Ω—Ç–∞</p>
        </div>

        <div class="button-group">
            <button class="test-button success" onclick="startConsoleLogging()">
                üìä –í–∫–ª—é—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏
            </button>
            <button class="test-button warning" onclick="clearLogs()">
                üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏
            </button>
            <button class="test-button primary" onclick="location.reload()">
                üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ—Å—Ç
            </button>
        </div>

        <div id="test-log" class="log"></div>
    </div>

    <!-- –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–∏–¥–∂–µ—Ç -->
    <iframe 
        id="voice-widget"
        src="https://mm-agent-v2-0.vercel.app/"
        style="
            border: 0;
            width: 200px;
            height: 120px;
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: transparent;
        "
        allow="microphone"
        title="–ì–æ–ª–æ—Å–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫"
    ></iframe>

    <script>
        const testLog = document.getElementById('test-log');
        const fixStatus = document.getElementById('fix-status');
        
        let logginEnabled = false;
        let audioElementCount = 0;
        let voiceCount = 0;
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            testLog.innerHTML += `[${timestamp}] ${prefix} ${message}\n`;
            testLog.scrollTop = testLog.scrollHeight;
        }

        function startConsoleLogging() {
            logginEnabled = true;
            addLog('–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ', 'success');
            
            // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.log –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
            const originalLog = console.log;
            console.log = function(...args) {
                originalLog.apply(console, args);
                if (logginEnabled) {
                    const message = args.join(' ');
                    if (message.includes('üîä') || message.includes('üì°') || message.includes('üßπ')) {
                        addLog(`CONSOLE: ${message}`);
                    }
                }
            };
        }

        function clearLogs() {
            testLog.innerHTML = '';
            addLog('–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã');
        }

        // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ audio —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ DOM
        function checkAudioElements() {
            const audioElements = document.querySelectorAll('audio');
            const currentCount = audioElements.length;
            
            if (currentCount !== audioElementCount) {
                if (currentCount > audioElementCount) {
                    addLog(`Audio —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω–æ: ${currentCount - audioElementCount}. –í—Å–µ–≥–æ: ${currentCount}`, 'info');
                } else {
                    addLog(`Audio —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–¥–∞–ª–µ–Ω–æ: ${audioElementCount - currentCount}. –í—Å–µ–≥–æ: ${currentCount}`, 'success');
                }
                audioElementCount = currentCount;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
                if (currentCount > 1) {
                    addLog(`‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ù–∞–π–¥–µ–Ω–æ ${currentCount} audio —ç–ª–µ–º–µ–Ω—Ç–æ–≤! –í–æ–∑–º–æ–∂–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ!`, 'warning');
                    fixStatus.className = 'fix-status issue';
                    fixStatus.innerHTML = `‚ö†Ô∏è –ù–∞–π–¥–µ–Ω–æ ${currentCount} audio —ç–ª–µ–º–µ–Ω—Ç–æ–≤ - –≤–æ–∑–º–æ–∂–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ!`;
                } else if (currentCount === 1) {
                    addLog(`‚úÖ –û–¥–∏–Ω audio —ç–ª–µ–º–µ–Ω—Ç - –Ω–æ—Ä–º–∞–ª—å–Ω–æ`, 'success');
                    fixStatus.className = 'fix-status';
                    fixStatus.innerHTML = `‚úÖ –ê—É–¥–∏–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (1 —ç–ª–µ–º–µ–Ω—Ç)`;
                } else {
                    fixStatus.className = 'fix-status';
                    fixStatus.innerHTML = `‚úÖ –ê—É–¥–∏–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ, —ç–ª–µ–º–µ–Ω—Ç—ã –æ—á–∏—â–µ–Ω—ã`;
                }
            }
        }

        // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –≤–∏–¥–∂–µ—Ç–∞
        window.addEventListener('message', (event) => {
            if (event.origin !== 'https://mm-agent-v2-0.vercel.app') return;

            console.log('Message from widget:', event.data);

            switch (event.data.type) {
                case 'widget-ready':
                    addLog(`‚úÖ –í–∏–¥–∂–µ—Ç –≥–æ—Ç–æ–≤: ${event.data.sessionId}`, 'success');
                    break;
                    
                case 'VOICE_WIDGET_STATE_CHANGE':
                    const state = event.data.state;
                    if (state.isConnected) {
                        addLog('üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∞–≥–µ–Ω—Ç—É —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'success');
                        voiceCount = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –≥–æ–ª–æ—Å–æ–≤
                    } else if (state.isConnecting) {
                        addLog('‚è≥ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∞–≥–µ–Ω—Ç—É...', 'info');
                    } else {
                        addLog('‚ö™ –û—Ç–∫–ª—é—á–µ–Ω–æ –æ—Ç –∞–≥–µ–Ω—Ç–∞', 'info');
                    }
                    break;
            }
        });

        // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
        setInterval(checkAudioElements, 2000);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        addLog('üöÄ –¢–µ—Å—Ç –¥–≤–æ–π–Ω–æ–≥–æ –≥–æ–ª–æ—Å–∞ –∑–∞–ø—É—â–µ–Ω');
        addLog('üí° –ù–∞–∂–º–∏—Ç–µ "–í–∫–ª—é—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏" –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏');
        addLog('üéØ –û–∂–∏–¥–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –≤–∏–¥–∂–µ—Ç–∞...');
    </script>
</body>
</html> 